{% extends 'public/base.html' %}

{% block title %}{{ author.name }} - 作者详情 | 图书管理系统{% endblock %}

{% block content %}
<!-- Page Header with gradient background -->
<section class="hero-section text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px 0; margin-bottom: 0;">
    <div class="container">
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-3">
                <div class="author-avatar" style="width: 60px; height: 60px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); display: flex; align-items: center; justify-content: center; border: 2px solid rgba(255, 255, 255, 0.4);">
                    <i class="fas fa-user-pen" style="font-size: 1.5rem; color: white;"></i>
                </div>
                <div>
                    <h1 class="h3 fw-bold mb-1">{{ author.name }}</h1>
                    <p class="mb-0 small opacity-90"><i class="fas fa-pen-fancy me-1"></i>作者</p>
                </div>
            </div>
            <a href="{% url 'manager:public_authors' %}" class="btn btn-light btn-sm">
                <i class="fas fa-arrow-left me-1"></i>返回列表
            </a>
        </div>
    </div>
</section>

<!-- Statistics Cards -->
<section class="py-3" style="background: #f8f9fa;">
    <div class="container">
        <div class="row g-2">
            <div class="col-lg-3 col-md-6 col-6">
                <div class="card border-0 shadow-sm" style="border-radius: 10px; background: white;">
                    <div class="card-body text-center p-3">
                        <div class="d-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px; margin: 0 auto; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-book text-white" style="font-size: 1rem;"></i>
                        </div>
                        <h5 class="fw-bold mb-0" style="color: #667eea;">{{ books.count }}</h5>
                        <small class="text-muted">作品</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-6">
                <div class="card border-0 shadow-sm" style="border-radius: 10px; background: white;">
                    <div class="card-body text-center p-3">
                        <div class="d-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px; margin: 0 auto; border-radius: 50%; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            <i class="fas fa-chart-line text-white" style="font-size: 1rem;"></i>
                        </div>
                        <h5 class="fw-bold mb-0" style="color: #10b981;">{{ total_sales }}</h5>
                        <small class="text-muted">销量</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-6">
                <div class="card border-0 shadow-sm" style="border-radius: 10px; background: white;">
                    <div class="card-body text-center p-3">
                        <div class="d-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px; margin: 0 auto; border-radius: 50%; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            <i class="fas fa-boxes text-white" style="font-size: 1rem;"></i>
                        </div>
                        <h5 class="fw-bold mb-0" style="color: #f59e0b;">{{ total_inventory }}</h5>
                        <small class="text-muted">库存</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-6">
                <div class="card border-0 shadow-sm" style="border-radius: 10px; background: white;">
                    <div class="card-body text-center p-3">
                        <div class="d-flex align-items-center justify-content-center mb-2" style="width: 40px; height: 40px; margin: 0 auto; border-radius: 50%; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);">
                            <i class="fas fa-tag text-white" style="font-size: 1rem;"></i>
                        </div>
                        <h5 class="fw-bold mb-0" style="color: #06b6d4;">¥{{ avg_price|floatformat:2 }}</h5>
                        <small class="text-muted">均价</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Author Info & Books Section -->
<section class="py-5">
    <div class="container">
        <div class="row g-4">
            <!-- Author Information Sidebar -->
            <div class="col-lg-3 order-lg-2">
                <div class="card border-0 shadow-sm sticky-top" style="border-radius: 10px; top: 90px;">
                    <div class="card-header text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px 10px 0 0; padding: 12px 15px;">
                        <h6 class="mb-0 fw-bold"><i class="fas fa-info-circle me-2"></i>作者信息</h6>
                    </div>
                    <div class="card-body p-3">
                        <div class="mb-2 pb-2 border-bottom">
                            <small class="text-muted d-block mb-1">姓名</small>
                            <p class="mb-0 fw-semibold small"><i class="fas fa-user text-primary me-1"></i>{{ author.name }}</p>
                        </div>
                        <div class="mb-2 pb-2 border-bottom">
                            <small class="text-muted d-block mb-1">ID</small>
                            <p class="mb-0 fw-semibold small"><i class="fas fa-id-badge text-info me-1"></i>#{{ author.id }}</p>
                        </div>
                        <div class="mb-0">
                            <small class="text-muted d-block mb-1">注册时间</small>
                            <p class="mb-0 fw-semibold small">
                                <i class="fas fa-calendar text-success me-1"></i>
                                {% if author.created_at %}
                                    {{ author.created_at|date:"Y-m-d" }}
                                {% else %}
                                    未知
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Books List -->
            <div class="col-lg-9 order-lg-1">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold mb-0" style="color: #333;">
                        <i class="fas fa-book-open me-2" style="color: #667eea;"></i>作品列表
                    </h5>
                    <span class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 0.85rem;">{{ books.count }} 本</span>
                </div>

                {% if books %}
                    <div class="row g-3">
                        {% for book in books %}
                        <div class="col-12">
                            <div class="card border-0 shadow-sm h-100" style="border-radius: 10px; transition: all 0.3s ease;">
                                <div class="card-body p-3">
                                    <div class="row g-3">
                                        <div class="col-md-2 col-sm-3">
                                            <div class="position-relative">
                                                <img src="{{ book.get_cover_url }}" alt="{{ book.name }}" 
                                                     class="img-fluid" 
                                                     style="border-radius: 8px; width: 100%; height: 140px; object-fit: cover; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                                <div class="position-absolute top-0 end-0 m-1">
                                                    <span class="badge text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 0.75rem; padding: 4px 8px;">
                                                        ¥{{ book.price }}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-10 col-sm-9">
                                            <h6 class="fw-bold mb-2" style="color: #333;">{{ book.name }}</h6>
                                            
                                            {% if book.description %}
                                            <p class="text-muted small mb-2" style="line-height: 1.4;">
                                                {{ book.get_short_description }}
                                            </p>
                                            {% endif %}

                                            <div class="row g-2 mb-2">
                                                <div class="col-md-6 col-6">
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-building me-1" style="color: #667eea;"></i>
                                                        {{ book.publisher.publisher_name }}
                                                    </small>
                                                </div>
                                                <div class="col-md-3 col-6">
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-boxes me-1" style="color: #f59e0b;"></i>
                                                        库存 {{ book.inventory }}
                                                    </small>
                                                </div>
                                                <div class="col-md-3 col-6">
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-chart-line me-1" style="color: #10b981;"></i>
                                                        销量 {{ book.sale_num }}
                                                    </small>
                                                </div>
                                            </div>

                                            <div class="d-flex gap-2">
                                                <a href="{% url 'manager:public_book_detail' book.id %}" 
                                                   class="btn btn-sm" 
                                                   style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 6px; font-size: 0.85rem;">
                                                    <i class="fas fa-info-circle me-1"></i>详情
                                                </a>
                                                {% if book.inventory > 0 %}
                                                    <form method="post" action="{% url 'manager:buy_now' book.id %}">
                                                        {% csrf_token %}
                                                        <button type="submit" class="btn btn-success btn-sm" style="border-radius: 6px; font-size: 0.85rem;">
                                                            <i class="fas fa-shopping-cart me-1"></i>购买
                                                        </button>
                                                    </form>
                                                {% else %}
                                                    <button class="btn btn-secondary btn-sm" style="border-radius: 6px; font-size: 0.85rem;" disabled>
                                                        <i class="fas fa-times me-1"></i>缺货
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5" data-aos="fade-up">
                        <div class="mb-4">
                            <i class="fas fa-book-open" style="font-size: 5rem; color: #e0e0e0;"></i>
                        </div>
                        <h4 class="text-muted mb-3">暂无作品</h4>
                        <p class="text-muted">该作者目前还没有任何已发布的作品。</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<style>
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15) !important;
    }
    
    .hero-section::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 100px;
        background: linear-gradient(to bottom, transparent, #f8f9fa);
        pointer-events: none;
    }
</style>
{% endblock %}
